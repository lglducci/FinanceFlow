{
  "name": "ProcessaDIarioContabil",
  "nodes": [
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -528,
        224
      ],
      "id": "48ef2362-8249-44a4-b6fa-072be651cd8b",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": "={{ $json.responseCode }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -544,
        48
      ],
      "id": "7db0ed76-de0f-45a2-b981-935c9397e228",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "content": "## DiÃ¡rio",
        "height": 1164,
        "width": 1248,
        "color": 3
      },
      "id": "251c42ed-7f41-40d4-b0b9-68618817af8b",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1344,
        16
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "gerar_staging",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1200,
        48
      ],
      "id": "aee11869-1d2c-42de-a029-ee16bd73ca44",
      "name": "GeraStaging",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.body.empresa_id}}",
              "type": "string"
            },
            {
              "id": "84d4691f-07a7-48da-85b9-ad6557a565a7",
              "name": "data_ini",
              "value": "= {{ $json.body.data_ini}}",
              "type": "string"
            },
            {
              "id": "e652a562-a4ac-4eba-ae02-bef31ce39227",
              "name": "data_fim",
              "value": "= {{ $json.body.data_fim}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -992,
        48
      ],
      "id": "e0cf3813-0814-4526-8082-e906bbb9b633",
      "name": "EditStaging"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": " select * from  contab.ff_gerar_diario_tudo ( {{ $json.empresa_id }},'{{ $json.data_ini }}','{{ $json.data_fim }}') ;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -752,
        48
      ],
      "id": "952d2eec-2cae-4e96-a12f-e213f7214229",
      "name": "ff_gerar_diario_tudo",
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "consolidar_diario",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1216,
        224
      ],
      "id": "32cb2a9b-54a2-49ab-83b3-846771ec7550",
      "name": "ConsolidaDiario",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.body.empresa_id}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -992,
        224
      ],
      "id": "7438c33e-6c39-47cd-82b8-24457b8d36f3",
      "name": "EditDelLote1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select * from  contab.ff_consolidar_diario_staging({{ $json.empresa_id }});\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -768,
        224
      ],
      "id": "b46ce0e5-26a9-4f39-977c-d1d01be2e572",
      "name": "ff_consolidar_diario_staging",
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": "={{ $json.responseCode }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -544,
        576
      ],
      "id": "acef373c-7a36-497e-861a-5d8f05d3d9a5",
      "name": "Respond to Webhook3"
    },
    {
      "parameters": {
        "path": "ultimo_processamento",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1232,
        576
      ],
      "id": "be2ac9ce-0f7a-4841-9d88-5242a2cb8555",
      "name": "Ultimo_process",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.query.empresa_id}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -992,
        576
      ],
      "id": "2ff1ce1d-22d6-4a82-a3c4-35ee2f8a2719",
      "name": "EditUltimo_process"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": "={{ $json.responseCode }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -544,
        400
      ],
      "id": "60e17bad-14e8-43ca-8f2d-d904e05ae888",
      "name": "Respond to Webhook4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.body.empresa_id}}",
              "type": "string"
            },
            {
              "id": "84d4691f-07a7-48da-85b9-ad6557a565a7",
              "name": "data_ini",
              "value": "= {{ $json.body.data_ini}}",
              "type": "string"
            },
            {
              "id": "e652a562-a4ac-4eba-ae02-bef31ce39227",
              "name": "data_fim",
              "value": "= {{ $json.body.data_fim}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -992,
        400
      ],
      "id": "32f4ddeb-d14a-4a06-b8f6-1d93e14ac722",
      "name": "EditStaging1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": " select  contab.ff_gerar_contabil_final ( {{ $json.empresa_id }},'{{ $json.data_ini }}','{{ $json.data_fim }}') ;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -752,
        400
      ],
      "id": "a876b11b-2e5a-452d-8e2f-8b85d969c932",
      "name": "ff_gerar_contabil_final",
      "executeOnce": false,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": "={{ $json.responseCode }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -336,
        768
      ],
      "id": "331ab41c-b585-41b2-bbd3-1f632dc1c26f",
      "name": "Respond to Webhook5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.body.empresa_id}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -992,
        768
      ],
      "id": "dbb66384-1ccc-4d00-8396-7a869cb783f7",
      "name": "EditUltimo_process1"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "voltadata",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1248,
        768
      ],
      "id": "4b145539-21a8-455b-8899-bc100ea7ff5a",
      "name": "voltadiaroo",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "gerar_contabil",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1232,
        400
      ],
      "id": "50bfad86-e967-4836-9acc-b950f5bb5853",
      "name": "geractbfinal",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": "={{ $json.responseCode }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -336,
        944
      ],
      "id": "09a5dead-9021-4f2c-8ca8-a417aa4110a8",
      "name": "Respond to Webhook6"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "excluilanctolote",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1232,
        944
      ],
      "id": "9e479802-faf3-439d-a4cc-dd6a516a44de",
      "name": "ExcluiLanctoLote",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "jsCode": " const item = $input.first().json;\n\n// ðŸ”¥ 1) DETECTA ERRO (Postgres mandou objeto com error)\nif (item?.error) {\n  return [\n    {\n      json: { \n      \n        ok: false,\n        message: $input.first().json.message|| \"Erro desconhecido\",\n        details:$input.first().json.error.description || null,\n        responseCode: 400\n    \n      }\n    }\n  ];\n}\n\n// ðŸ”¥ 2) DETECTA SUCESSO (Postgres retornou array normal)\nreturn [\n  {\n    json: {\n      ok: true,\n      message: \"OperaÃ§Ã£o realizada com sucesso\",\n      responseCode: 200,\n      data: item || null\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -528,
        944
      ],
      "id": "a3a112bf-60b7-40dc-9221-d004da9dc5e9",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": "={{ $json.responseCode }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1024,
        64
      ],
      "id": "59ba068f-82ab-49c5-9055-87af71bae2de",
      "name": "Respond to Webhook7"
    },
    {
      "parameters": {
        "jsCode": " const item = $input.first().json;\n\n// ðŸ”¥ 1) DETECTA ERRO (Postgres mandou objeto com error)\nif (item?.error) {\n  return [\n    {\n      json: { \n      \n        ok: false,\n        message: $input.first().json.message|| \"Erro desconhecido\",\n        details:$input.first().json.error.description || null,\n        responseCode: 400\n    \n      }\n    }\n  ];\n}\n\n// ðŸ”¥ 2) DETECTA SUCESSO (Postgres retornou array normal)\nreturn [\n  {\n    json: {\n      ok: true,\n      message: \"OperaÃ§Ã£o realizada com sucesso\",\n      responseCode: 200,\n      data: item || null\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        832,
        64
      ],
      "id": "02bd495f-d75f-4ffd-9c56-e2e12b9311a0",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.body.empresa_id}}",
              "type": "string"
            },
            {
              "id": "e9b5eb72-5abd-4439-a777-7a9bd194dab8",
              "name": "ano",
              "value": "={{ $json.body.ano}}",
              "type": "string"
            },
            {
              "id": "bdbb44c8-dbc8-4161-be77-cfa6dfc5220f",
              "name": "mes",
              "value": "={{ $json.body.mes}}",
              "type": "string"
            },
            {
              "id": "68201ad3-ee37-444d-98ef-55ba2922ae60",
              "name": "usuario",
              "value": "={{ $json.body.usuario}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        352,
        64
      ],
      "id": "0a9a3b38-738d-4b3a-8704-935f39b4c4c8",
      "name": "Edit_Aputracao"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select * from  contab.ff_fechar_mes( \n {{ $json.empresa_id }}, {{ $json.ano }} ,  {{ $json.mes }}, {{ $json.usuario }}  )",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        608,
        64
      ],
      "id": "720b44a4-f696-43f1-bb56-134438a8fd8b",
      "name": "ff_fechar_mes",
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "apuracao_resultado",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        112,
        64
      ],
      "id": "60c241e8-b001-4242-8b0a-41fa313273a6",
      "name": "Apura Resultado DRE contabil",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": "={{ $json.responseCode }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1024,
        256
      ],
      "id": "e3133344-2591-4f53-a4cf-909b73244d9c",
      "name": "Respond to Webhook8"
    },
    {
      "parameters": {
        "jsCode": " const item = $input.first().json;\n\n// ðŸ”¥ 1) DETECTA ERRO (Postgres mandou objeto com error)\nif (item?.error) {\n  return [\n    {\n      json: { \n      \n        ok: false,\n        message: $input.first().json.message|| \"Erro desconhecido\",\n        details:$input.first().json.error.description || null,\n        responseCode: 400\n    \n      }\n    }\n  ];\n}\n\n// ðŸ”¥ 2) DETECTA SUCESSO (Postgres retornou array normal)\nreturn [\n  {\n    json: {\n      ok: true,\n      message: \"OperaÃ§Ã£o realizada com sucesso\",\n      responseCode: 200,\n      data: item || null\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        832,
        256
      ],
      "id": "8c7dca86-2c53-47a1-bfd0-2c9f51381f8e",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": " select * from contab.ff_ultima_apuracao(\n {{ $json.empresa_id }}\n)",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        608,
        256
      ],
      "id": "63007a42-c722-498d-9850-da7efaacf183",
      "name": "UltimoResultado",
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "content": "## ApuraÃ§Ãµes",
        "height": 1196,
        "width": 1264,
        "color": 4
      },
      "id": "5b191a93-9f25-4f68-ae1c-4b023453b53d",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ultima_apuracao",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        112,
        256
      ],
      "id": "2ad04cc3-b761-49c4-a499-95aa3e9b0276",
      "name": "Ultima Apuracao",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.body.empresa_id}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        352,
        256
      ],
      "id": "737b0b0f-af90-4e8c-994b-e8f635561f8a",
      "name": "Edit_ult_apuracao"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": "={{ $json.responseCode }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1040,
        448
      ],
      "id": "d92b29ca-2573-4635-b44a-a331ac2d1233",
      "name": "Respond to Webhook9"
    },
    {
      "parameters": {
        "jsCode": " const item = $input.first().json;\n\n// ðŸ”¥ 1) DETECTA ERRO (Postgres mandou objeto com error)\nif (item?.error) {\n  return [\n    {\n      json: { \n      \n        ok: false,\n        message: $input.first().json.message|| \"Erro desconhecido\",\n        details:$input.first().json.error.description || null,\n        responseCode: 400\n    \n      }\n    }\n  ];\n}\n\n// ðŸ”¥ 2) DETECTA SUCESSO (Postgres retornou array normal)\nreturn [\n  {\n    json: {\n      ok: true,\n      message: \"OperaÃ§Ã£o realizada com sucesso\",\n      responseCode: 200,\n      data: item || null\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        832,
        448
      ],
      "id": "879984df-2c62-4ad3-adde-852eba8cdb31",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": " select * from contab.ff_status_apuracao(\n {{ $json.empresa_id }}, {{ $json.ano}} ,  {{ $json.mes }} \n)\n\n ",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        624,
        448
      ],
      "id": "08b66d17-c712-48d8-98f4-719221dbefe8",
      "name": "UltimoResultado1",
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.body.empresa_id}}",
              "type": "string"
            },
            {
              "id": "90a22337-aa57-47fc-a95e-89524db69172",
              "name": "ano",
              "value": "={{ $json.body.ano}}",
              "type": "string"
            },
            {
              "id": "d688372e-75a5-4e6b-82a3-68c5ba8b37b4",
              "name": "mes",
              "value": "={{ $json.body.mes}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        368,
        448
      ],
      "id": "6aacab29-9c2c-4f26-b7d2-7f00a9abf58b",
      "name": "Edit_ult_apuracao1"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "status_apuracao",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        128,
        448
      ],
      "id": "12a4d2f1-f859-482b-9745-e22650687fa6",
      "name": "Saatus Apuracao",
      "webhookId": "77c2764f-3d24-48db-aef2-07b64e9ecdeb"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9979082e-9a0e-48c7-a643-b189cf149b01",
              "name": "empresa_id",
              "value": "={{ $json.body.empresa_id}}",
              "type": "string"
            },
            {
              "id": "e9b5eb72-5abd-4439-a777-7a9bd194dab8",
              "name": "lote_id",
              "value": "={{ $json.body.lote_id}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -992,
        944
      ],
      "id": "b3ae6c37-ef5d-4dde-b98f-f7327474d64a",
      "name": "Editexclui_lote"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": " \nCALL contab.sp_reset_contabil_desde_data({{ $json.empresa_id }});",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -752,
        768
      ],
      "id": "6b0985c9-2092-4f83-9251-673fd40fbb52",
      "name": "sp_reset_contabil_desde_data",
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": " select * from contab.controle_fechamento  where empresa_id =  {{ $json.empresa_id }} ",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -752,
        576
      ],
      "id": "d3241a89-4a6b-456a-addd-6dcd1e71a98b",
      "name": "controle_fechamento",
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select * from  contab.ff_excluir_lancamentos_lote( \n {{ $json.empresa_id }}, {{ $json.lote_id }})",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -752,
        944
      ],
      "id": "87b7f299-f922-4d0b-b8a5-8499ee41feda",
      "name": "ff_excluir_lancamentos_lote",
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wvOAuqaHViEwm60r",
          "name": "FInanceFlow"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": " const item = $input.first().json;\n\n// ðŸ”¥ 1) DETECTA ERRO (Postgres mandou objeto com error)\nif (item?.error) {\n  return [\n    {\n      json: { \n      \n        ok: false,\n        message: $input.first().json.message|| \"Erro desconhecido\",\n        details:$input.first().json.error.description || null,\n        responseCode: 400\n    \n      }\n    }\n  ];\n}\n\n// ðŸ”¥ 2) DETECTA SUCESSO (Postgres retornou array normal)\nreturn [\n  {\n    json: {\n      ok: true,\n      message: \"OperaÃ§Ã£o realizada com sucesso\",\n      responseCode: 200,\n      data: item || null\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -544,
        768
      ],
      "id": "7d183e2a-f5b7-4cca-8cad-b701d945ca6d",
      "name": "Code in JavaScript4"
    }
  ],
  "pinData": {
    "Edit_ult_apuracao1": [
      {
        "json": {
          "empresa_id": 1,
          "ano": "2026",
          "mes": "1"
        }
      }
    ],
    "Editexclui_lote": [
      {
        "json": {
          "empresa_id": 1,
          "lote_id": 22
        }
      }
    ],
    "EditUltimo_process1": [
      {
        "json": {
          "empresa_id": 1
        }
      }
    ]
  },
  "connections": {
    "GeraStaging": {
      "main": [
        [
          {
            "node": "EditStaging",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EditStaging": {
      "main": [
        [
          {
            "node": "ff_gerar_diario_tudo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ff_gerar_diario_tudo": {
      "main": [
        [
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ConsolidaDiario": {
      "main": [
        [
          {
            "node": "EditDelLote1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EditDelLote1": {
      "main": [
        [
          {
            "node": "ff_consolidar_diario_staging",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ff_consolidar_diario_staging": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ultimo_process": {
      "main": [
        [
          {
            "node": "EditUltimo_process",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EditUltimo_process": {
      "main": [
        [
          {
            "node": "controle_fechamento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EditStaging1": {
      "main": [
        [
          {
            "node": "ff_gerar_contabil_final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ff_gerar_contabil_final": {
      "main": [
        [
          {
            "node": "Respond to Webhook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EditUltimo_process1": {
      "main": [
        [
          {
            "node": "sp_reset_contabil_desde_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "voltadiaroo": {
      "main": [
        [
          {
            "node": "EditUltimo_process1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "geractbfinal": {
      "main": [
        [
          {
            "node": "EditStaging1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ExcluiLanctoLote": {
      "main": [
        [
          {
            "node": "Editexclui_lote",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Respond to Webhook6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Respond to Webhook7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit_Aputracao": {
      "main": [
        [
          {
            "node": "ff_fechar_mes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ff_fechar_mes": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apura Resultado DRE contabil": {
      "main": [
        [
          {
            "node": "Edit_Aputracao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Respond to Webhook8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UltimoResultado": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ultima Apuracao": {
      "main": [
        [
          {
            "node": "Edit_ult_apuracao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit_ult_apuracao": {
      "main": [
        [
          {
            "node": "UltimoResultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Respond to Webhook9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UltimoResultado1": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit_ult_apuracao1": {
      "main": [
        [
          {
            "node": "UltimoResultado1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Saatus Apuracao": {
      "main": [
        [
          {
            "node": "Edit_ult_apuracao1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Editexclui_lote": {
      "main": [
        [
          {
            "node": "ff_excluir_lancamentos_lote",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sp_reset_contabil_desde_data": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "controle_fechamento": {
      "main": [
        [
          {
            "node": "Respond to Webhook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ff_excluir_lancamentos_lote": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Respond to Webhook5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "b75b2ad3-32cd-4ede-b825-c5de44db89e8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "33738330930e3881dd5571eca013f36ddf8aab20e4ea5c1f2ebaf4a2b4668ac6"
  },
  "id": "PbaNNT1ODhfTfB5f",
  "tags": []
}